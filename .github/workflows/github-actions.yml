name: deployment pipeline
on:
- push
- workflow_dispatch
jobs:
  automated_testing:
    runs-on: self-hosted
    steps:
    - name: Check out the code. 
      uses: actions/checkout@v4

    - name: Check if Dotnet format changed anything.
      run: |
        nix-shell -p dotnet-sdk_9 --run "
          dotnet format --verify-no-changes --verbosity diagnostic DerpRaven.Api
          dotnet format --verify-no-changes --verbosity diagnostic DerpRaven.Shared
          dotnet format --verify-no-changes --verbosity diagnostic DerpRaven.NTests
          dotnet build --warnaserror DerpRaven.Api
          dotnet build --warnaserror DerpRaven.Shared
          dotnet build --warnaserror DerpRaven.NTests
        "

    - name: Run the tests.
      run: |
        docker build \
          -f ./Test.Api.Dockerfile \
          -t thomas_test_container \
          .

        docker run --rm thomas_test_container
        echo "going to deploy!!!"

